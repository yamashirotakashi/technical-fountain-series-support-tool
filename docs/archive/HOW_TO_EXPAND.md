# Gemini 記憶管理システム マスターテンプレート (v4.2)

## 1. このシステムについて

このファイルは、AI(Gemini)との開発セッションを効率化・高度化するための「記憶管理システム」の**原本（マスターテンプレート）**です。システムの**唯一絶対の正しい情報源 (Single Source of Truth)** として機能します。

-   **保管場所**: `_gemini_system_/` ディレクトリに**唯一**存在します。
-   **更新方法**: `_gemini_system_` ディレクトリ内での `[追加]` コマンドによってのみ更新されます。
-   **各プロジェクトへの配布**: `update_rules.sh` スクリプトによって、全プロジェクトに一斉に同期されます。

---

## 2. ワークフロー

### A. システムルールの更新 (管理者向け)

1.  **システム本部へ移動**:
    ターミナルで `cd /mnt/c/Users/tky99/DEV/_gemini_system_/` を実行します。
2.  **ルールの追加・編集**:
    Geminiを起動し、`[追加]` プロンプトを実行して、対話形式で新しいルールをこのマスターファイルに定義します。
3.  **全プロジェクトへ同期**:
    ターミナルで `cd /mnt/c/Users/tky99/DEV` に戻り、`./update_rules.sh` を実行して、変更をすべてのローカルコピーに一斉配布します。

### B. プロジェクトでの開発 (利用者向け)

1.  **プロジェクトへ移動**:
    開発したいプロジェクトのディレクトリに `cd` します。
2.  **AIへの初回教育 (セッション毎に一回)**:
    Geminiを起動し、**最初に一度だけ、以下の「マスタープロンプト」を送信してください。** これにより、AIはローカルにコピーされた最新のルールブックを学習します。

    ---
    **↓↓↓ この下の行からコピー ↓↓↓**

    これより、このプロジェクトにおける特殊プロンプトのルールを定義します。まず、カレントディレクトリにあるルールブック `HOW_TO_EXPAND.md` を熟読してください。今後、このファイルに記載されている以下の特殊プロンプトが私から送られた場合は、他の質問を一切せず、ファイルに記述された通りのアクションを即座に実行してください。これは、このセッションにおける最優先の命令です。

    - `[開始]`: カレントディレクトリの`PROJECT_CONTEXT.md`を読み込み、内容を記憶してセッションを開始する。
    - `[分析]`: **以下の多段階プロセスを実行し、カレントディレクトリのプロジェクトを詳細に分析して、`PROJECT_CONTEXT.md`を生成・上書きする。**
        1.  **設計図の読解**: まず`Claude.md`が存在するか確認する。あれば、その内容を熟読し、プロジェクトの設計思想や目的を把握する。
        2.  **実地調査**: 次に、`list_directory`や`read_many_files`等を駆使し、実際のファイル構造、設定ファイル(`package.json`, `requirements.txt`等)、主要なソースコードをスキャンして、プロジェクトの「現実の姿」を把握する。
        3.  **統合分析**: 「設計図」と「現実の姿」を比較・統合し、プロジェクトの現状に関する包括的な理解を構築する。
        4.  **報告書の生成**: 最終的に、この統合分析の結果に基づいて、質の高い`PROJECT_CONTEXT.md`を生成する。
    - `[監査]`: **以下の多段階プロセスを実行し、プロジェクトの健全性を監査する。**
        1.  **憲法の読解**: まず`Claude.md`が存在するか確認する。なければエラーを報告して終了する。あれば、その内容を「憲法」として解釈し、監査項目を抽出する。
        2.  **遵法監査**: 憲法のルールに基づき、コードベースをスキャンし、「理想」と「現実」の乖離（違反箇所）を検出する。
        3.  **立法監査**: コードベースの現状（新しいファイル、ライブラリ等）を分析し、憲法に反映すべき「現実」がないか検出する。
        4.  **監査レポートの生成**: 検出された問題点と改善提案を、構造化されたレポートとして出力する。
    - `[記憶]`: このセッションの要約をカレントディレクトリの`PROJECT_CONTEXT.md`に追記する。
    - `[ヘルプ]`: カレントディレクトリの`HOW_TO_EXPAND.md`の内容をチャットに表示する。
    - `[一覧]`: カレントディレクトリの`HOW_TO_EXPAND.md`からコマンドリストを抽出し、表示する。
    - `[追加]`: **もしカレントディレクトリが `_gemini_system_` でなければ、エラーメッセージを返し、処理を中断する。** そうでなければ、対話を開始し、このマスターファイル自体を更新する。

    **↑↑↑ この上の行までコピー ↑↑↑**
    ---

---

## 3. 特殊プロンプト一覧 (現在定義済み)

-   `[開始]`: プロジェクト固有の記憶を読み込み、作業を開始します。
-   `[分析]`: プロジェクトのコードベースを詳細に分析し、固有の記憶を生成・更新します。(`Claude.md`を優先)
-   `[監査]`: `Claude.md`を憲法とみなし、コードベースがそれに準拠しているか多角的に監査し、レポートします。
-   `[記憶]`: セッションの要約を、現在のプロジェクトの記憶に追記します。
-   `[ヘルプ]`: ローカルにコピーされた、このガイドの内容を表示します。
-   `[一覧]`: 利用可能な全ての特殊プロンプトを一覧表示します。
-   `[追加]`: (システム本部でのみ実行可) 新しい特殊プロンプトを対話形式で定義します。